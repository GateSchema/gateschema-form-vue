!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("gateschema-transformer"),require("vue")):"function"==typeof define&&define.amd?define(["exports","gateschema-transformer","vue"],e):e(t.GateSchemaForm={},t.GateSchemaTransformer,t.Vue)}(this,function(t,n,s){"use strict";function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n=n&&n.hasOwnProperty("default")?n.default:n,s=s&&s.hasOwnProperty("default")?s.default:s;var e={namespaced:!0,state:{},mutations:{setValueOfFormPath:function(t,e){var i=e.name,a=e.path,n=e.value,r=e.parentValue,o=e.key;"/"===a?s.set(t,i,n):s.set(r,o,n)}}};t.transformer=n,t.createForm=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.StateForm,i=t.transformer,h=void 0===i?n:i,a=t.vuexModuleName,s=void 0===a?"form":a;return{data:function(){return{activePaths:{},validationOptions:{skipAsync:!0,useCache:!0},submitValidationOptions:{useCache:!0},pathValidationOptions:{}}},props:{schema:{type:Object},value:{},name:{},debounce:{type:Number},ignoreErrors:{type:Object,default:function(){return{map:!0,list:!0}}}},methods:{setValueOfFormPath:function(t,e,i,a){"/"===t?this.$emit("input",e):this.$parent.$set(i,a,e)},transformNode:function(t,e){var i=this.activePaths,a=this.ignoreErrors,n=t.path,r=t.error,o=t.value,s=t.constraints,h=s.type,u=s.other,c=(void 0===u?{}:u).form||{};if(!c.hidden){var l;r&&!a[r.keyword]&&(this.errors.push(r),l=r.msg);var m=Object.assign({},c,{path:n,required:s.required,error:i[n]&&l||void 0,value:o,children:t.children,option:s.option}),f=m.component||("/"===n?"Form":{list:"List",map:"Map",string:"Input",number:"InputNumber",boolean:"Switch",enumList:"Checkbox",enum:"Radio"}[h]);return"Select"===f&&"enumList"===h&&(m.multiple=!0),!m.label&&e&&"list"!==e.constraints.type&&(m.label=n.slice(n.lastIndexOf("/")+1)),m.component=f,this.cache[n]={type:h,item:m},m}},setFormState:function(t){this.formState=t,this.$forceUpdate()},updateValue:function(t,e,i){var a=this,n=this.value,r=t.split("/").slice(1),o=r.length;if(0===o)return this.setValueOfFormPath("/",e);var s=n||{};s!==n&&this.setValueOfFormPath("/",s);for(var h=o-1,u="",c=0;c<o;c++){var l=r[c];if(u+="/"+l,c<h){var m=s[l];null!=m&&"object"===f(m)||(m="list"===this.cache[u].type?[]:{},this.setValueOfFormPath(u,m,s,l)),s=m}else this.setValueOfFormPath(u,e,s,l)}this.$nextTick(function(){var t={cb:function(){a.$emit("update",a.errors)}};return i?a.renderSchema(t):a.renderSchemaDebounced(t)})},handleUserInput:function(t,e,i){var a,n,r,o=!1,s=this.cache[t].type;if("string"===s&&""===e)e=void 0;else if("list"===s&&(o=!0,void 0!==i)){var h=this.activePaths,u={},c=[],l=t+"/";Object.keys(h).forEach(function(t){0===t.indexOf(l)?c.push(t):u[t]=!0});var m,f,d,p=new RegExp("^"+t+"\\/(\\d)(\\/.*)?");c.forEach(function(t){m=t.match(p),f=~~m[1],d=m[2]||"",f<i?u[t]=!0:i<f&&(u[l+(f-1)+d]=!0)}),this.activePaths=u}this.activePaths[t]=!0,this.pathValidationOptions=(r={skipAsync:(a={},!1)},(n=t)in a?Object.defineProperty(a,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[n]=r,a),this.updateValue(t,e,o)},handleSubmit:function(){var t=this,e=this.activePaths;Object.keys(this.cache).forEach(function(t){e[t]=!0}),this.renderSchema({validationOptions:this.submitValidationOptions,cb:function(){t.$emit("submit",t.errors)}})},handleReset:function(){this.$emit("reset")},renderSchema:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=t.cb,a=t.validationOptions,n=void 0===a?this.validationOptions:a,r=t.pathValidationOptions,o=void 0===r?this.pathValidationOptions:r;this.errors=[],this.cache={};var s={path:"/",value:this.value,rootData:this.value,validationOptions:n,pathValidationOptions:o,transform:this.transformNode};h.transform(this.schema,s,function(t){return e.setFormState(t),i&&i()})}},render:function(t){return t(e,{props:{state:this.formState},on:{submit:this.handleSubmit,reset:this.handleReset,input:this.handleUserInput}},this.$slots.default)},created:function(){if(this.name){var n=this.name,r=s+"/setValueOfFormPath";this.setValueOfFormPath=function(t,e,i,a){this.$store.commit(r,{name:n,path:t,value:e,parentValue:i,key:a})}}var i,a,o;this.$watch("schema",{handler:this.renderSchema}),this.$watch("value",{handler:this.renderSchema}),this.renderSchemaDebounced=this.debounce?(i=this.renderSchema,a=this.debounce,function(){var t=this,e=arguments;clearTimeout(o),o=setTimeout(function(){o=null,i.apply(t,e)},a)}):this.renderSchema,this.schema&&this.renderSchemaDebounced()}}},t.formStore=e,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=gateschema-form-vue.js.map
