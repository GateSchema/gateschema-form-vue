!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("gateschema-transformer"),require("vue")):"function"==typeof define&&define.amd?define(["exports","gateschema-transformer","vue"],e):e(t.GateSchemaForm={},t.GateSchemaTransformer,t.Vue)}(this,function(t,n,s){"use strict";function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n=n&&n.hasOwnProperty("default")?n.default:n,s=s&&s.hasOwnProperty("default")?s.default:s;var e={namespaced:!0,state:{},mutations:{setValueOfFormPath:function(t,e){var a=e.name,r=e.path,i=e.value,n=e.parentValue,o=e.key;"/"===r?s.set(t,a,i):s.set(n,o,i)}}};t.transformer=n,t.createForm=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.StateForm,a=t.transformer,r=void 0===a?n:a,i=t.vuexModuleName,s=void 0===i?"form":i;return{data:function(){return{activePaths:{},validationOptions:{skipAsync:!0,useCache:!0},pathValidationOptions:{}}},props:{schema:{type:Object},value:{},name:{},debounce:{type:Number},ignoreErrors:{type:Object,default:function(){return{map:!0,list:!0}}}},methods:{setValueOfFormPath:function(t,e,a,r){"/"===t?this.$emit("input",e):this.$parent.$set(a,r,e)},transformNode:function(t,e){var a=this.activePaths,r=this.ignoreErrors,i=t.path,n=t.error,o=t.value,s=t.constraints,h=s.type,u=s.other,c=(void 0===u?{}:u).form||{};if(!c.hidden){var m;n&&!r[n.keyword]&&(this.errors.push(n),m=n.msg);var f=Object.assign({},c,{path:i,required:s.required,error:a[i]&&m||void 0,value:o,children:t.children,option:s.option}),l=f.component||("/"===i?"Form":{list:"List",map:"Map",string:"Input",number:"InputNumber",boolean:"Switch",enumList:"Checkbox",enum:"Radio"}[h]);return"Select"===l&&"enumList"===h&&(f.multiple=!0),!f.label&&e&&"list"!==e.constraints.type&&(f.label=i.slice(i.lastIndexOf("/")+1)),f.component=l,this.cache[i]={type:h,item:f},f}},setFormState:function(t){this.formState=t,this.$forceUpdate()},updateValue:function(t,e,a){var r=this,i=this.value,n=t.split("/").slice(1),o=n.length;if(0===o)return this.setValueOfFormPath("/",e);var s=i||{};s!==i&&this.setValueOfFormPath("/",s);for(var h=o-1,u="",c=0;c<o;c++){var m=n[c];if(u+="/"+m,c<h){var f=s[m];null!=f&&"object"===l(f)||(f="list"===this.cache[u].type?[]:{},this.setValueOfFormPath(u,f,s,m)),s=f}else this.setValueOfFormPath(u,e,s,m)}this.$nextTick(function(){return a?r.renderSchema():r.renderSchemaDebounced()})},handleUserInput:function(t,e,a){var r,i,n,o=!1,s=this.cache[t].type;if("string"===s&&""===e)e=void 0;else if("list"===s&&(o=!0,void 0!==a)){var h=this.activePaths,u={},c=[],m=t+"/";Object.keys(h).forEach(function(t){0===t.indexOf(m)?c.push(t):u[t]=!0});var f,l,d,p=new RegExp("^"+t+"\\/(\\d)(\\/.*)?");c.forEach(function(t){f=t.match(p),l=~~f[1],d=f[2]||"",l<a?u[t]=!0:a<l&&(u[m+(l-1)+d]=!0)}),this.activePaths=u}this.activePaths[t]=!0,this.pathValidationOptions=(n={skipAsync:(r={},!1)},(i=t)in r?Object.defineProperty(r,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[i]=n,r),this.updateValue(t,e,o)},handleSubmit:function(){var t=this,e=this.activePaths;Object.keys(this.cache).forEach(function(t){e[t]=!0}),this.renderSchema(function(){t.$emit("submit",t.errors)})},handleReset:function(){this.$emit("reset")},renderSchema:function(e){var a=this;this.errors=[],this.cache={};var t={path:"/",value:this.value,rootData:this.value,validationOptions:this.validationOptions,pathValidationOptions:this.pathValidationOptions,transform:this.transformNode};r.transform(this.schema,t,function(t){return a.setFormState(t),e&&e()})}},render:function(t){return t(e,{props:{state:this.formState},on:{submit:this.handleSubmit,reset:this.handleReset,input:this.handleUserInput}},this.$slots.default)},created:function(){if(this.name){var i=this.name,n=s+"/setValueOfFormPath";this.setValueOfFormPath=function(t,e,a,r){this.$store.commit(n,{name:i,path:t,value:e,parentValue:a,key:r})}}var a,r,o;this.$watch("schema",{handler:this.renderSchema}),this.renderSchemaDebounced=this.debounce?(a=this.renderSchema,r=this.debounce,function(){var t=this,e=arguments;clearTimeout(o),o=setTimeout(function(){o=null,a.apply(t,e)},r)}):this.renderSchema,this.schema&&this.renderSchemaDebounced()}}},t.formStore=e,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=gateschema-form-vue.js.map
